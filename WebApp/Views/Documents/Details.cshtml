@model WebApp.Models.Document
@{
    ViewData["Title"] = "Document Details";
}

<div class="container mt-5 mb-5">
    <div class="card shadow-lg border-0">
        <!-- 🔷 Header -->
        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
            <h4 class="mb-0">
                <i class="bi bi-file-earmark-text"></i> Document Details
            </h4>
            <a asp-action="Index" class="btn btn-light btn-sm">
                <i class="bi bi-arrow-left"></i> Back to List
            </a>
        </div>

        <!-- 📄 Document Information -->
        <div class="card-body bg-light">
            <div class="row">
                <div class="col-md-6">
                    <dl class="row">
                        <dt class="col-sm-4 fw-bold">File Name:</dt>
                        <dd class="col-sm-8">@Model.FileName</dd>

                        <dt class="col-sm-4 fw-bold">Upload Date:</dt>
                        <dd class="col-sm-8">@Model.UploadDate.ToLocalTime().ToString("f")</dd>

                        <dt class="col-sm-4 fw-bold">Category:</dt>
                        <dd class="col-sm-8">
                            <span class="badge bg-info text-dark px-3 py-2">
                                @(string.IsNullOrWhiteSpace(Model.Category?.Name)
                                                                ? "Uncategorized"
                                                                : Model.Category.Name)
                            </span>
                        </dd>

                        <dt class="col-sm-4 fw-bold">File:</dt>
                        <dd class="col-sm-8">
                            <a href="@Model.FilePath" target="_blank" class="text-decoration-none">
                                <i class="bi bi-box-arrow-up-right"></i> View File
                            </a>
                        </dd>
                    </dl>
                </div>

                <!-- 🖼️ Image Preview -->
                <div class="col-md-6 text-center">
                    @{
                        var ext = System.IO.Path.GetExtension(Model.FilePath)?.ToLower();
                        var isImage = new[] { ".jpg", ".jpeg", ".png", ".gif" }.Contains(ext);
                    }

                    @if (isImage)
                    {
                        <img src="@Model.FilePath" alt="@Model.FileName"
                             class="img-fluid rounded border shadow-sm"
                             style="max-height: 300px; object-fit: contain;" />
                    }
                    else
                    {
                        <div class="text-muted fst-italic mt-4">
                            No image preview available.
                        </div>
                    }
                </div>
            </div>

            <hr class="my-4" />

            <!-- 🧠 Extracted Text (OCR) -->
            <div class="d-flex justify-content-between align-items-center mb-2">
                <h5 class="text-secondary mb-0">
                    <i class="bi bi-text-paragraph"></i> Extracted Text (OCR)
                </h5>
                <button id="copyTextBtn" class="btn btn-outline-secondary btn-sm">
                    <i class="bi bi-clipboard"></i> Copy Text
                </button>
            </div>

            <div id="ocrTextContainer" class="p-3 bg-white border rounded shadow-sm" style="min-height: 150px;">
                @if (ViewBag.Text != null && !string.IsNullOrWhiteSpace(ViewBag.Text))
                {
                    <pre id="ocrText" style="white-space: pre-wrap; font-family: 'Segoe UI', sans-serif;">
    @ViewBag.Text
                        </pre>
                }
                else
                {
                    <p class="text-muted fst-italic">
                        No extracted text available.
                    </p>
                }
            </div>
        </div>

        <!-- 🔻 Footer -->
        <div class="card-footer text-end bg-white border-top">
            <form asp-action="Delete" asp-route-id="@Model.Id" method="post" class="d-inline">
                <button type="submit" class="btn btn-danger"
                        onclick="return confirm('Are you sure you want to delete this document?');">
                    <i class="bi bi-trash"></i> Delete
                </button>
            </form>
        </div>
    </div>
</div>

<!-- ✨ Copy to Clipboard Script -->
@section Scripts {
    <script>
        const btn = document.getElementById("copyTextBtn");
        btn?.addEventListener("click", () => {
            const textEl = document.getElementById("ocrText");
            if (textEl) {
                navigator.clipboard.writeText(textEl.innerText.trim())
                    .then(() => alert("✅ Extracted text copied to clipboard!"))
                    .catch(err => alert("❌ Failed to copy text: " + err));
            }
        });
    </script>
}
